# Name
CastleLoader and CastleRAT Log File Creation

# Description
Detects CastleRAT C variant malware log file creation events. The log file is used to store output from the keylogger and clipboard stealer.

# References
- https://www.esentire.com/blog/new-botnet-emerges-from-the-shadows-nightshadec2
- https://www.darktrace.com/blog/castleloader-castlerat-behind-tag150s-modular-malware-delivery-system
- https://www.splunk.com/en_us/blog/security/castlerat-malware-detection-splunk-mitre-attck.html
- https://www.recordedfuture.com/research/from-castleloader-to-castlerat-tag-150-advances-operations
- https://www.recordedfuture.com/research/graybravos-castleloader-activity-clusters-target-multiple-industries

# Author
- M4nbat
  
# Socials
- https://www.linkedin.com/in/grjk83/
- @knappresearchlb

# Threats
- CastleRAT
- CastleLoader
- TAG150

# MITRE Techniques
- T1115 : Clipboard Data

# Data Sources
- Microsoft Defender for Endpoint (MDE)
  - DeviceFileEvents

# Query

```

//CastleLoader and CastleRAT - File Detections
//Detects CastleRAT C variant malware log file creation events. The log file is used to store output from the keylogger and clipboard stealer.
references
DeviceFileEvents | where (FolderPath endswith @'\AppData\Local\Temp\MuuuuuhGer3' or FolderPath endswith @'\AppData\Local\Temp\PluhhSuk3' or FolderPath endswith @'\AppData\Local\Temp\AsdDsaHaha3' or FolderPath endswith @'\AppData\Local\Temp\ChuChuka' or FolderPath endswith @'\AppData\Local\Temp\GagikMaraguiSS' or FolderPath endswith @'\AppData\Local\Temp\LowUshrSudujes' or FolderPath endswith @'\AppData\Local\Temp\RarnuiKarta' or FolderPath endswith @'\AppData\Local\Temp\GrazGraznii' or FolderPath endswith @'\AppData\Local\Temp\GiveGvein3' or FolderPath endswith @'\AppData\Local\Temp\BeruiowdgsouiHTR' or FolderPath endswith @'\AppData\Local\Temp\GDSongdsgndohSDU' or FolderPath endswith @'\AppData\Local\JohniiDepp' or FolderPath endswith @'\AppData\Local\LuchiiSvet' or FolderPath endswith @'\AppData\Local\HmmMaybe')

```
